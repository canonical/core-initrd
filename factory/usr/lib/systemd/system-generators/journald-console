#!/bin/sh

set -eu

mode="$(/usr/libexec/core/get-mode mode)" || mode="$(/usr/libexec/core/get-arg snapd_recovery_mode)" || mode="run"

if [ "${mode}" = "run" ]; then
    # remove any previous overrides
    rm -rf /run/systemd/journald.conf.d/core-override.conf
    exit 0
fi

if /usr/libexec/core/get-arg quiet; then
    exit 0
fi

mkdir -p /run/systemd/journald.conf.d
cat <<EOF >/run/systemd/journald.conf.d/core-override.conf
[Journal]
ForwardToConsole=true
EOF
